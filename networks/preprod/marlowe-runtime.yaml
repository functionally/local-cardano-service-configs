
apiVersion: v1
kind: Pod
metadata:
  name: mrt-preprod
  labels:
    app: mrt-preprod
spec:
  hostname: mrt-preprod
  containers:

  - name: node
    image: docker.io/inputoutput/cardano-node:8.1.2
    command:
    - /usr/local/bin/entrypoint
    env:
    - name: NETWORK
      value: preprod
    volumeMounts:
    - mountPath: /ipc
      name: shared
    - mountPath: /data/db
      name: node-db

  - name: chain-indexer
    image: docker.io/bwbush/marlowe-chain-indexer:811318bd01960a2b3444eac48ea771496dfa3b16
    depends_on:
    - node
    env:
    - name: CARDANO_NODE_SOCKET_PATH
      value: /ipc/node.socket
    - name: NODE_CONFIG
      value: /ipc/config/node.json
    - name: DB_HOST
      value: host.containers.internal
    - name: DB_USER
      value: cardano
    - name: DB_PASS
      value: bcb33b5c09e31e3dd5a2b4ff0ee111e6
    - name: DB_NAME
      value: preprod
    - name: HTTP_PORT
      value: 3781
    volumeMounts:
    - mountPath: /ipc
      name: shared
    - mountPath: /data/db
      name: node-db

  - name: chain-sync
    image: docker.io/bwbush/marlowe-chain-sync:811318bd01960a2b3444eac48ea771496dfa3b16
    depends_on:
    - node
    env:
    - name: HOST
      value: mrt-preprod
    - name: PORT
      value: 3715
    - name: QUERY_PORT
      value: 3716
    - name: JOB_PORT
      value: 3720
    - name: CARDANO_NODE_SOCKET_PATH
      value: /ipc/node.socket
    - name: NODE_CONFIG
      value: /ipc/config/node.json
    - name: DB_HOST
      value: host.containers.internal
    - name: DB_USER
      value: cardano
    - name: DB_PASS
      value: bcb33b5c09e31e3dd5a2b4ff0ee111e6
    - name: DB_NAME
      value: preprod
    - name: HTTP_PORT
      value: 3782
    ports:
    - hostPort: 13715
      containerPort: 3715
    - hostPort: 13716
      containerPort: 3716
    - hostPort: 13720
      containerPort: 3720
    volumeMounts:
    - mountPath: /ipc
      name: shared

  - name: marlowe-indexer
    image: docker.io/bwbush/marlowe-indexer:811318bd01960a2b3444eac48ea771496dfa3b16
    depends_on:
    - chain-sync
    env:
    - name: MARLOWE_CHAIN_SYNC_HOST
      value: mrt-preprod
    - name: MARLOWE_CHAIN_SYNC_PORT
      value: 3715
    - name: MARLOWE_CHAIN_SYNC_QUERY_PORT
      value: 3716
    - name: DB_HOST
      value: host.containers.internal
    - name: DB_USER
      value: cardano
    - name: DB_PASS
      value: bcb33b5c09e31e3dd5a2b4ff0ee111e6
    - name: DB_NAME
      value: preprod
    - name: HTTP_PORT
      value: 3783

  - name: marlowe-sync
    image: docker.io/bwbush/marlowe-sync:811318bd01960a2b3444eac48ea771496dfa3b16
    env:
    - name: MARLOWE_CHAIN_SYNC_HOST
      value: mrt-preprod
    - name: MARLOWE_CHAIN_SYNC_QUERY_PORT
      value: 3716
    - name: HOST
      value: mrt-preprod
    - name: MARLOWE_SYNC_PORT
      value: 3724
    - name: MARLOWE_HEADER_SYNC_PORT
      value: 3725
    - name: MARLOWE_QUERY_PORT
      value: 3726
    - name: MARLOWE_BULK_SYNC_PORT
      value: 3730
    - name: DB_HOST
      value: host.containers.internal
    - name: DB_USER
      value: cardano
    - name: DB_PASS
      value: bcb33b5c09e31e3dd5a2b4ff0ee111e6
    - name: DB_NAME
      value: preprod
    - name: HTTP_PORT
      value: 3784
    ports:
    - hostPort: 13724
      containerPort: 3724
    - hostPort: 13725
      containerPort: 3725
    - hostPort: 13726
      containerPort: 3726
    - hostPort: 13730
      containerPort: 3730
  
  - name: contract
    image: docker.io/bwbush/marlowe-contract:811318bd01960a2b3444eac48ea771496dfa3b16
    env:
    - name: HOST
      value: mrt-preprod
    - name: PORT
      value: 3727
    - name: QUERY_PORT
      value: 3728
    - name: TRANSFER_PORT
      value: 3729
    - name: STORE_DIR
      value: /store
    - name: MARLOWE_CHAIN_SYNC_HOST
      value: mrt-preprod
    - name: MARLOWE_CHAIN_SYNC_QUERY_PORT
      value: 3716
    - name: SYNC_HOST
      value: mrt-preprod
    - name: MARLOWE_BULK_SYNC_PORT
      value: 3730
    - name: HTTP_PORT
      value: 3786
    ports:
    - hostPort: 13727
      containerPort: 3727
    - hostPort: 13728
      containerPort: 3728
    - hostPort: 13729
      containerPort: 3729
    volumeMounts:
    - mountPath: /store
      name: contracts
  
  - name: tx
    image: docker.io/bwbush/marlowe-tx:811318bd01960a2b3444eac48ea771496dfa3b16
    depends_on:
    - chain-sync
    env:
    - name: HOST
      value: mrt-preprod
    - name: PORT
      value: 3723
    - name: MARLOWE_CHAIN_SYNC_HOST
      value: mrt-preprod
    - name: MARLOWE_CHAIN_SYNC_PORT
      value: 3715
    - name: MARLOWE_CHAIN_SYNC_QUERY_PORT
      value: 3716
    - name: MARLOWE_CHAIN_SYNC_COMMAND_PORT
      value: 3720
    - name: CONTRACT_HOST
      value: mrt-preprod
    - name: CONTRACT_QUERY_PORT
      value: 3728
    - name: HTTP_PORT
      value: 3785
    ports:
    - hostPort: 13723
      containerPort: 3723
  
  - name: proxy
    image: docker.io/bwbush/marlowe-proxy:811318bd01960a2b3444eac48ea771496dfa3b16
    depends_on:
    - marlowe-sync
    - tx
    - contract
    env:
    - name: HOST
      value: mrt-preprod
    - name: PORT
      value: 3700
    - name: TRACED_PORT
      value: 3701
    - name: TX_HOST
      value: mrt-preprod
    - name: TX_PORT
      value: 3723
    - name: SYNC_HOST
      value: mrt-preprod
    - name: MARLOWE_SYNC_PORT
      value: 3724
    - name: MARLOWE_HEADER_SYNC_PORT
      value: 3725
    - name: MARLOWE_QUERY_PORT
      value: 3726
    - name: CONTRACT_HOST
      value: mrt-preprod
    - name: LOAD_PORT
      value: 3727
    - name: CONTRACT_QUERY_PORT
      value: 3728
    - name: TRANSFER_PORT
      value: 3729
    - name: SYNC_HOST
      value: mrt-preprod
    - name: MARLOWE_BULK_SYNC_PORT
      value: 3730
    - name: HTTP_PORT
      value: 3787
    ports:
    - hostPort: 13700
      containerPort: 3700
    - hostPort: 13701
      containerPort: 3701
  
  - name: web-server
    image: docker.io/bwbush/marlowe-web-server:811318bd01960a2b3444eac48ea771496dfa3b16
    depends_on:
    - proxy
    env:
    - name: PORT
      value: 3780
    - name: RUNTIME_HOST
      value: mrt-preprod
    - name: RUNTIME_PORT
      value: 3701
    ports:
    - hostPort: 13780
      containerPort: 3780

  volumes:
  - name: shared
    hostPath:
      type: Directory
      path: ./.
  - name: contracts
    hostPath:
      type: Directory
      path: ./contracts
  - name: node-db
    hostPath:
      type: Directory
      path: ./node.db

  restartPolicy: Always
  enableServiceLinks: false
  automountServiceAccountToken: false
status: {}

####---
####
####apiVersion: v1
####kind: Pod
####metadata:
####  name: mrx-preprod
####  labels:
####    app: mrx-preprod
####spec:
####  hostname: mrx-preprod
####  containers:
####
####  - name: benchmark
####    image: docker.io/bwbush/marlowe-benchmark:811318bd01960a2b3444eac48ea771496dfa3b16
####    depends_on:
####    - proxy
####    env:
####    - name: MARLOWE_RT_HOST
####      value: host.containers.internal
####    - name: MARLOWE_RT_PORT
####      value: 13700
####    - name: MARLOWE_BENCHMARK_CONFIG
####      value: /benchmark/config.json
####    - name: CARDANO_NODE_SOCKET_PATH
####      value: /ipc/node.socket
####    - name: CARDANO_TESTNET_MAGIC
####      value: 1
####    - name: FAUCET_ADDRESS
####      value: /benchmark/faucet.address
####    - name: FAUCET_SKEY
####      value: /benchmark/faucet.skey
####    - name: MARLOWE_BENCHMARK_OUTPUT
####      value: /benchmark/results.json
####    volumeMounts:
####    - mountPath: /ipc
####      name: shared
####    - mountPath: /benchmark
####      name: benchmark
####
####  - name: oracle
####    image: docker.io/bwbush/marlowe-oracle:811318bd01960a2b3444eac48ea771496dfa3b16
####    depends_on:
####    - proxy
####    env:
####    - name: MARLOWE_RT_HOST
####      value: host.containers.internal
####    - name: MARLOWE_RT_PORT
####      value: 13700
####    - name: ADDRESS
####      value: addr_test1vrzq87cu5aefqrfzaaxq4nzjksx3nht25727nprg9ydzsksn2jucp
####    - name: KEYFILE
####      value: /oracle/oracle.skey
####    - name: TIMEOUT_SECONDS
####      value: 900
####    - name: BUILD_SECONDS
####      value: 3
####    - name: CONFIRM_SECONDS
####      value: 3
####    - name: RETRY_SECONDS
####      value: 10
####    - name: RETRY_LIMIT
####      value: 5
####    - name: POLLING_FREQUENCY
####      value: 5
####    - name: REQUEUING_FREQUENCY
####      value: 20
####    volumeMounts:
####    - mountPath: /ipc
####      name: shared
####    - mountPath: /oracle
####      name: oracle
####
####  volumes:
####  - name: shared
####    hostPath:
####      type: Directory
####      path: ./.
####  - name: benchmark
####    hostPath:
####      type: Directory
####      path: ./benchmark
####  - name: oracle
####    hostPath:
####      type: Directory
####      path: ./oracle
####
####  restartPolicy: Never
####  enableServiceLinks: false
####  automountServiceAccountToken: false
####status: {}
