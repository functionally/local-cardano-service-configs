#!/usr/bin/env bash

set -eo pipefail

SKOPEO=$(nix build --no-link --print-out-paths github:nlewo/nix2container#skopeo-nix2container | tail -n 1)/bin/skopeo

cd marlowe-cardano

for img in marlowe-chain-indexer marlowe-chain-sync marlowe-indexer marlowe-sync marlowe-contract marlowe-tx marlowe-proxy marlowe-web-server marlowe-oracle marlowe-benchmark
do
  echo $img
  nix build .#oci-images.x86_64-linux.$img
  sed -e 's/0108ad4d4fe2e41705eb8a27292d5bbc350419f3121297582583eb209c10799c/247aed5894d312df05ab7d6bf00da3e7f350a6379cecd7ee523c442e5ea74cae/' \
      -e 's/05213de87c1902fbccf957c829a086d1ed63b9631a91c44fe0de20ebe748cd9e/1b563f155e53d901c37f3d955b822ca2e2654e5726dca8fbd755c6f999f2cd90/' \
      -e 's/0c74e3c19c89242a27833fd32ad670c3ccc545c68c86ea22e54491cb39bd0e23/9523c88d20d9d5e3769c2c24fc95cfe8af65f6b77dd9fceadc3fa23de20a7ab5/' \
      -e 's/0ecb61704fee7cdd14a8edbc9ea71f6e6ca1c02398130d796fd26cbc6b6b32af/e246035ad2e92d752df12f7945139aa52ff4f91f51b466b91438ae810d214bbe/' \
      -e 's/0ee10e5824c00520058a2bebfe60ced9e3df9cc9b324b495069dae9461ab1c6d/e41e904387fd142fbfdc944ca4babd03501999207529c383ebbf7fb899732f53/' \
      -e 's/15a203bcdbd537cc7951c1e93b6f20fd32eeaef990f7fe8adbdee275c8dada91/32377bf586bd2dd8bd30450b3137cccda94791721337a887e65baccfd9c72272/' \
      -e 's/1afc76f5c81927cc0525b0504cf313e53b45c1e9bb0cffc748cdb4b08a4bd275/d02ace0e03f95a0b26a65a7a08271acba881405f99876f19f70f98dc65127767/' \
      -e 's/1de29835b224ea78ec986f6cac4ddc9aeae47ea614920b29fc6a3000385656c4/221baa1ce3321c29738e75654450042e8517449f943d127cb04c11b72afd8cd3/' \
      -e 's/2824de88f9cb5eb6f2bc799cf7d42f60407e40f3ac76e10c684762edc11d0bf6/d1c0cc333cac999bb92cf1130cf4b5c869ca7bb5f572f3f879feac26acc53b9a/' \
      -e 's/28dcd93282dd923b63f450e51e02e4b7cf58cf978deacdcc961fbb93550ff411/6830c538fa676584c607a6e340ae07c64b495ae4278eab886fa02bf0051dd4d0/' \
      -e 's/2deebadf41190d540570b27bbea0b588acf3f0621478b08ab848c4217b85a5f4/cc05ef63ef5b66e8b1f6958531aa4b32caac9ca51bf408357e7103d702016f38/' \
      -e 's/352668399f7a3ef74525ef815b5085fdc34ffd98ad92332aa3a4ecc3d757f350/401a7985ffac63adaa12aff2dd0c5913ce164c62f15ab67231abd7197ac09fdd/' \
      -e 's/3ca5eed860108b71fd3c44e04f89cfe426abf403ed0923c5d18217b1bfded0dd/400a04101de3e7393d2a61383e5142d57a54cf0beca5668852cf4a610d57b2a5/' \
      -e 's/3f56da64a8eb8df2a582695b5fb9cc1e37db0928510efaba181f73db2d8c00c4/4176351213ed79171dd9ca8e31753ea3141ca22f9b84619ef23f9fc0551d403a/' \
      -e 's/4026bb32ac4c50a89b63a32c83715afb03290547986726535a1dd8232d61b7ca/ce9000145f2f3dbe0296d05ce1bd1daac7798001540e877375a2a0c54bc77621/' \
      -e 's/46d6a0780271378747d21ba67469963ec921077f647d7d10f2e56cc13633cd66/b388321ed796d84d12db17c8e45fd4008205b8f9b1f06bfdd66b9f77e1b9096c/' \
      -e 's/4dcf5fd5b7bd716092cf05a04c557d064d0469445f5a53a0c8ca9209ff203d56/76a9d957e8251d67719eefe870dc47fd101f5e971337a63287005d0c4c8cd726/' \
      -e 's/4f2fc4931f1cf735af0afe8bb5fbe68f55915836d5d1fb8e639d2089e56e720b/815657abb9b03d0aa1cddcd1a0285d2bfa50da01069acb2d5cc935c7d3043639/' \
      -e 's/574c9b7729b59de19d0350f714d377f3966447a2c46c8ba586705bf075663021/2602d52d26e24e219e0e3a7ec67e468b285d6f026f50d5b69a0c598ed751da4d/' \
      -e 's/59630a265612f1cdc3848e8f295710b3091064cea689c467b628300b77cc531f/b50d155c98b40c8e8560eb62f8b2361cbdc9bb09dc13835b87b4f7cd4cab148a/' \
      -e 's/59fed313f0282957388cb6f0ded3cb96731cb07ce1e273b01dcab9ac552af1d6/f10d332f04a560a34da93f63bacd0624e138aded4cd9a703d377fff57bf6708d/' \
      -e 's/66091964fa9744b16885d1e1d1c2a1e92d00b350523a16b6ff9d353d63d5e7e7/f832184eea765bf7b7646292065bc2376bbe5928e126677962b318bc5ec31dc0/' \
      -e 's/6853789eb20f334c33c631a165c23cb32507ce847f13a31f3e59a57441dcd1b6/d50f0c338d2c4ddf79b65c2ae828ea19722738274c72adeddb7a216e0fe53012/' \
      -e 's/6f19e1f7060adc7a8814da88a67cea06f230906c3b64bca238bbfbaeb790e6ad/fdffa5d7fb14a6e1a76b63b73fa0c571edb4187f5080280419019f10a9485f69/' \
      -e 's/6f460bb20b34056219fcf261307da887caa9f6cf866e5ef06aa9a60f2c9c9512/6894323f0dfd48c838580e2a3b3b922b71846563e759fdcf4df1a013bc3a2f22/' \
      -e 's/7163a732fd3ecc35e029c6abed270f3a8c54fb2edc6330a5ad65da2f00aa7a62/ecf3acc361348591ef1bfbb1c8aeb018803d05a40fdb880c80a08f4abf77170c/' \
      -e 's/8aec68f9c44a75fde831315955b6875648d693d201dbc00fae64723186f60e19/4eb18975c581971e0248ae1dab44206be630913cc72a12bd1bc7b4bf71894c50/' \
      -e 's/9432bcc55ae61b7dd5431b5ad53126e949305a7d2ac0c30718444a04cfd58716/3ab7448f99ce542816d2600c0ecd14c6d2e23307087e646e932997ca8dc377ad/' \
      -e 's/9841eddc33ce758c1ae67c8fd29aa1e9dd60146617b2fe83c79448f7b05bd060/f8b406d6cd6303c8470ab0c006dcca41f885cbb3eeeaf8ee7817bd3851a69e6a/' \
      -e 's/aa01e571a6922fc9b353ad12ab8cdd661d181433057e6c4c6f0c5f57b9f03e1a/caf6da0006c54933e8a2b0f7f7ef29c82dbae35e09c37e7b0e26d5c827ff869f/' \
      -e 's/aa7d506c2396964faaec1cc751f2937c169f5eff7ccdc8af7aafd67e512e8997/2a65d7a0bac282e3fc172c7eaf0336f40d8f603d0a15fb979c67fa21fcbdc924/' \
      -e 's/ad7293956b1cc2d2f59504b8a3cf56daf4739c9eaeee1101a185dd1ff790dd81/64404330bf63386001a1fd9fa1db982824ffc77d372aaf7a59791524f84b10fb/' \
      -e 's/be3b00f41937f2bd2607b4d2c81ae50a1828d016c733b61bc731ce5e77304b62/25cc62446fe150f2f9c29c939cf0d56fd29b8fe9c290876b04beb19ae951c932/' \
      -e 's/c1034abe2dc6e8f32999571ea63500e30e1fabc5beda11ed2f5909ffd086dfb7/96e153f522b30184f7a90b51168f6091e8caf9406dc074576a955958d55630e4/' \
      -e 's/c74d95c56829156a7c1c6e5f90943586745cd7dd513e662f8e80e966ae4b1362/7de1125c2b0aee118771d743655cd037c890c82c29cb6481933783d659cde913/' \
      -e 's/c91700648cdff035074c105710cb522a25bf30f019721250b67bf988247b736c/046d1b20b9019a8e843197c1db872023ec241c23c005dfa3380768d80816b193/' \
      -e 's/c9ea30c93944cbf74ca7b0f462137c523f23a0e7307e297648d80f4a58a174d0/db0aedf1a058632022b8dbc6f506eba5588502287f0f493a9483f199ff9469a5/' \
      -e 's/ccbd0277cb43b2b87f1cbb8c2dc5786aa6283ee5ad4cfc8222190eeb1865d0e1/8a2a38cae3bb044243bf76382ecf4b4116caf7cfd86e68f81c6887c65ad96bbb/' \
      -e 's/cda80f86cc503c5a7957012ebfc2042e92f387b53e09bb043f870bf7c44e0e09/96286adab3a4c2233ac78d85a17d07c25a238fb435396f9ab6cd9992e4c34f30/' \
      -e 's/d783f0f97a7ee15e608dd5d10094cb0a0cd04e6b1fd2cc4ebc4a7505ff689212/ef4b18f91801489757b59b066cbad865d356e64aa8345388c3c80ffda5f3735c/' \
      -e 's/d9d5ce7a20d99a197215905f00b607c104f84d442b92f07ec33b0200c8f65bc3/f71c670381e320bf62914479c12f1259d0c4eea61967f67fee55aba585533555/' \
      -e 's/e2d4c30ae6b6b13127f6d32d45d422e4b7cd0b6963f50e6b643c9f43326a3f2e/d9c7e0ea95a9a28e504c8325e1709cbf6ba15375547698934891fc0fcdd267e6/' \
      -e 's/f07ad2cea53c356d7bb4e6ddf10b58ca00f94ade6f65cbce408bd8b79b5a8b77/d8c0ea71e37841df63d977bb0fe66739423b3a9e8fbbde4f593bbc92db9c92d5/' \
      -e 's/f1669ed4dcc664b29219e4c1d8b1524b5a830f70a67169807493ca178347e26f/67413a4a14cdfacb3364ffb739ded07219919f691e4d7d8c70f739ef1b0b07b0/' \
      result > image.json
  $SKOPEO --insecure-policy copy nix:image.json docker://docker.io/bwbush/$img:latest
  rm image.json result
done
